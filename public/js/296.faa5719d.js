"use strict";(self["webpackChunktg_bot_client_app"]=self["webpackChunktg_bot_client_app"]||[]).push([[296,163],{9879:function(e,t,r){var l=r(100),o=function(){function e(){}return Object.defineProperty(e,"setNewName",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return l.Z.patch("/tools/name",{name:e})}}),Object.defineProperty(e,"setNewEmail",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return l.Z.patch("/tools/email",{email:e})}}),Object.defineProperty(e,"setNewPassword",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return l.Z.patch("/tools/password",{newPassword:e,oldPassword:t})}}),Object.defineProperty(e,"setGoogleServiceAccountSettings",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,o){return l.Z.post("/tools/google/service",{serviceUser:e,servicePrivateKey:t,sheetId:r,folderId:o})}}),Object.defineProperty(e,"giveAdminRights",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return l.Z.post("/tools/giverights",{email:e})}}),Object.defineProperty(e,"takeAdminRights",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return l.Z.post("/tools/takerights",{email:e})}}),Object.defineProperty(e,"getUsers",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return l.Z.get("/tools/users",{params:{_id:e}})}}),Object.defineProperty(e,"updateRoles",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return l.Z.post("/tools/setroles",{_id:e,roles:t})}}),e}();t["Z"]=o},4163:function(e,t,r){r.r(t),r.d(t,{default:function(){return v}});var l=r(6252),o=r(3577),i=(0,l.Uk)("На главную");function s(e,t,r,s,n,a){var u=(0,l.up)("v-button");return(0,l.wg)(),(0,l.iD)("div",{class:(0,o.C_)(e.$style.error)},[(0,l._)("div",{class:(0,o.C_)(e.$style.error_info)},[(0,l._)("div",{class:(0,o.C_)(e.$style.error_code)},(0,o.zw)(r.code),3),(0,l._)("div",{class:(0,o.C_)(e.$style.error_text)},(0,o.zw)(r.message),3),(0,l.Wm)(u,{class:(0,o.C_)(e.$style.error_button),onClick:t[0]||(t[0]=function(t){return e.$router.push("/")})},{default:(0,l.w5)((function(){return[i]})),_:1},8,["class"])],2)],2)}var n=(0,l.aZ)({__name:"TheError",props:{code:{type:[String,Number],required:!0},message:{type:String,required:!0}},setup:function(e,t){var r=t.expose;r();var l={};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}}),a={error:"TheError_error_zWRpU",error_info:"TheError_error_info_bRaoI",error_code:"TheError_error_code_p9lzC",error_text:"TheError_error_text_fLubd",error_button:"TheError_error_button_wjtdJ"},u=r(3744);const c={};c["$style"]=a;const d=(0,u.Z)(n,[["render",s],["__cssModules",c]]);var v=d},5296:function(e,t,r){r.r(t),r.d(t,{default:function(){return Ce}});var l=r(6252);function o(e,t,r,o,i,s){return o.store.isAdmin?((0,l.wg)(),(0,l.j4)(o["TheTools"],{key:1})):((0,l.wg)(),(0,l.j4)(o["TheError"],{key:0,code:403,message:"Forbidden"}))}var i=r(4402),s=r(4163),n=r(3577),a=function(e){return(0,l.dD)("data-v-abfa3064"),e=e(),(0,l.Cn)(),e},u=(0,l.Uk)("На главную"),c={class:"container"},d={class:"tools"},v=a((function(){return(0,l._)("h1",{class:"tools_title"},"Инструменты",-1)})),f={class:"tools_item"},m={class:"tools_item"},_={key:0,class:"item_sheets"},g={key:0,class:"sheets_block"},p={key:1,class:"sheets_block"},b={class:"block_year"},h={key:2,class:"sheets_block"},w={class:"buttons"},y=(0,l.Uk)("Сформировать"),k={class:"message"},V={key:3,class:"sheets_block"},S=["href"],U={class:"tools_item"},C={key:0,class:"item_form"};function Z(e,t,r,o,i,s){var a=(0,l.up)("VButton"),Z=(0,l.up)("VSelect"),T=(0,l.up)("VInput"),I=(0,l.up)("LoadingWheel");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(a,{class:"home_button",onClick:t[0]||(t[0]=function(t){return e.$router.push("/")})},{default:(0,l.w5)((function(){return[u]})),_:1}),(0,l._)("div",c,[(0,l._)("ul",d,[v,(0,l._)("li",f,[(0,l._)("div",{class:"item_title",onClick:t[1]||(t[1]=function(e){return o.setVisible("integrate")})},"Настроить интеграцию с Google"),o.tools.integrate?((0,l.wg)(),(0,l.j4)(o["TheToolsGoogle"],{key:0})):(0,l.kq)("",!0)]),(0,l._)("li",m,[(0,l._)("div",{class:"item_title",onClick:t[2]||(t[2]=function(e){return o.setVisible("sheets")})},"Выгрузить заявки в Google Sheets"),o.tools.sheets?((0,l.wg)(),(0,l.iD)("ul",_,[(0,l.Wm)(o["CheckboxFilter"],{filters:o.filtersOptions,onFiltered:o.filtered}),o.filter.includes("district")?((0,l.wg)(),(0,l.iD)("li",g,[(0,l.Wm)(Z,{class:"sheets_select",modelValue:o.selectedFilters.district,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.selectedFilters.district=e}),options:o.Constants.districtOptions,title:"Район"},null,8,["modelValue","options"])])):(0,l.kq)("",!0),o.filter.includes("birth")?((0,l.wg)(),(0,l.iD)("li",p,[(0,l._)("div",b,[(0,l.Wm)(T,{class:"year_interval",modelValue:o.selectedFilters.birth.from,"onUpdate:modelValue":t[4]||(t[4]=function(e){return o.selectedFilters.birth.from=e}),type:"number",placeholder:"С"},null,8,["modelValue"]),(0,l.Wm)(T,{class:"year_interval",modelValue:o.selectedFilters.birth.to,"onUpdate:modelValue":t[5]||(t[5]=function(e){return o.selectedFilters.birth.to=e}),type:"number",placeholder:"По"},null,8,["modelValue"])])])):(0,l.kq)("",!0),o.filter.length?((0,l.wg)(),(0,l.iD)("li",h,[(0,l._)("div",w,[(0,l.Wm)(a,{onClick:o.saveFormsToSheet,disabled:o.isDisabled},{default:(0,l.w5)((function(){return[y]})),_:1},8,["disabled"]),o.isLoading?((0,l.wg)(),(0,l.j4)(I,{key:0})):(0,l.kq)("",!0),(0,l._)("div",k,(0,n.zw)(o.message),1)])])):(0,l.kq)("",!0),o.link?((0,l.wg)(),(0,l.iD)("li",V,[(0,l._)("a",{class:"sheets_link",target:"_blank",href:o.link},"Ссылка на выгруженные заявки",8,S)])):(0,l.kq)("",!0)])):(0,l.kq)("",!0)]),(0,l._)("li",U,[(0,l._)("div",{class:"item_title",onClick:t[6]||(t[6]=function(e){return o.setVisible("adminRights")})},"Настроить роли пользователей"),o.tools.adminRights?((0,l.wg)(),(0,l.iD)("form",C,[(0,l.Wm)(o["UserList"])])):(0,l.kq)("",!0)])])])],64)}var T=r(2262),I=r(6442),P=r(9879),j=r(6091),D=function(e){return(0,l.dD)("data-v-e631a3b2"),e=e(),(0,l.Cn)(),e},F={class:"filter_container"},W=D((function(){return(0,l._)("div",{class:"filter_title"},"Критерии выгрузки",-1)})),A={class:"filter_content"},L={class:"item_title"};function q(e,t,r,o,i,s){var a=(0,l.up)("VCheckbox");return(0,l.wg)(),(0,l.iD)("div",F,[W,(0,l._)("div",A,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(r.filters,(function(e){return(0,l.wg)(),(0,l.iD)("div",{class:"filter_item",key:e.name},[(0,l._)("header",L,(0,n.zw)(e.name),1),(0,l.Wm)(a,{modelValue:o.filterValue,"onUpdate:modelValue":t[0]||(t[0]=function(e){return o.filterValue=e}),value:e.value},null,8,["modelValue","value"])])})),128))])])}var O=(0,l.aZ)({__name:"CheckboxFilter",props:{filters:{type:Array,default:[]}},emits:["filtered"],setup:function(e,t){var r=t.expose,o=t.emit;r();var i=(0,T.iH)([]);(0,l.YP)(i,(function(e){o("filtered",e)}),{deep:!0,immediate:!0});var s={emit:o,filterValue:i,ref:T.iH,watch:l.YP};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}}),x=r(3744);const H=(0,x.Z)(O,[["render",q],["__scopeId","data-v-e631a3b2"]]);var R=H,K=function(e){return(0,l.dD)("data-v-1f235791"),e=e(),(0,l.Cn)(),e},z={key:0,class:"loader"},E=K((function(){return(0,l._)("span",null,null,-1)})),G={key:1,class:"content"},$={class:"user_list"},N=K((function(){return(0,l._)("tr",{class:"list_header"},[(0,l._)("th",null,"Имя"),(0,l._)("th",null,"Е-мэйл"),(0,l._)("th",null,"Роль")],-1)})),Y={class:"list_row"},M={class:"row_item"},Q={class:"row_item"},B={class:"row_item"},J={class:"roles"},X=K((function(){return(0,l._)("label",{class:"role_name"},"Пользователь",-1)})),ee={class:"roles"},te=K((function(){return(0,l._)("label",{class:"role_name"},"Админ ",-1)}));function re(e,t,r,o,i,s){var a=(0,l.up)("LoadingWheel"),u=(0,l.up)("VInput"),c=(0,l.up)("VCheckbox");return o.isLoading?((0,l.wg)(),(0,l.iD)("div",z,[(0,l.Wm)(a),E])):((0,l.wg)(),(0,l.iD)("div",G,[(0,l.Wm)(u,{class:"search",placeholder:"Поиск",modelValue:o.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=function(e){return o.searchQuery=e})},null,8,["modelValue"]),(0,l._)("table",$,[(0,l._)("tbody",null,[N,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(o.searchedUsers,(function(e){return(0,l.wg)(),(0,l.iD)("tr",Y,[(0,l._)("td",M,(0,n.zw)(e.name),1),(0,l._)("td",Q,(0,n.zw)(e.email),1),(0,l._)("td",B,[(0,l._)("div",J,[(0,l.Wm)(c,{class:"role_set",value:"user",modelValue:e.roles,"onUpdate:modelValue":function(t){return e.roles=t},disabled:!0},null,8,["modelValue","onUpdate:modelValue"]),X]),(0,l._)("div",ee,[(0,l.Wm)(c,{class:"role_set",value:"admin",modelValue:e.roles,"onUpdate:modelValue":function(t){return e.roles=t},onChange:function(t){return o.updateRoles(e._id,e.roles)}},null,8,["modelValue","onUpdate:modelValue","onChange"]),te])])])})),256))])])]))}var le=r(2416),oe=(0,l.aZ)({__name:"UserList",setup:function(e,t){var r=t.expose;r();var o=(0,i.o)(),s=(0,T.iH)([]),n=(0,T.iH)(!1),a=(0,T.iH)(""),u=(0,T.iH)(""),c=(0,l.Fl)((function(){return s.value.filter((function(e){return e.email.toLowerCase().includes(u.value.toLowerCase())||e.name.toLowerCase().includes(u.value.toLowerCase())}))}));function d(e,t){console.log(e),P.Z.updateRoles(e,t).then((function(e){return console.log(e.data.message)}))}(0,l.bv)((function(){n.value=!0,P.Z.getUsers(o.user._id).then((function(e){s.value=e.data})).catch((function(e){var t,r;return a.value=null===(r=null===(t=null===e||void 0===e?void 0:e.response)||void 0===t?void 0:t.data)||void 0===r?void 0:r.message})).finally((function(){return n.value=!1}))}));var v={store:o,users:s,isLoading:n,errorMessage:a,searchQuery:u,searchedUsers:c,updateRoles:d,onMounted:l.bv,ref:T.iH,computed:l.Fl,IUser:le.ex,ToolsService:P.Z,useStore:i.o};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}});const ie=(0,x.Z)(oe,[["render",re],["__scopeId","data-v-1f235791"]]);var se=ie,ne=r(9963),ae=function(e){return(0,l.dD)("data-v-367e6e3c"),e=e(),(0,l.Cn)(),e},ue=["onSubmit"],ce=ae((function(){return(0,l._)("div",{class:"google_title"},"Service account email",-1)})),de=ae((function(){return(0,l._)("div",{class:"google_title"},"Service account private key",-1)})),ve=ae((function(){return(0,l._)("div",{class:"google_title"},"Sheet ID",-1)})),fe=ae((function(){return(0,l._)("div",{class:"google_title"},"Folder ID",-1)})),me={class:"google_control"},_e=(0,l.Uk)("Сохранить"),ge={class:"google_message"};function pe(e,t,r,o,i,s){var a=(0,l.up)("VInput"),u=(0,l.up)("VButton"),c=(0,l.up)("LoadingWheel");return(0,l.wg)(),(0,l.iD)("form",{class:"google",onSubmit:(0,ne.iM)(o.setGoogleApi,["prevent"])},[ce,(0,l.Wm)(a,{class:"google_input",modelValue:o.googleApi.serviceUser,"onUpdate:modelValue":t[0]||(t[0]=function(e){return o.googleApi.serviceUser=e}),placeholder:"email"},null,8,["modelValue"]),de,(0,l.Wm)(a,{class:"google_input",modelValue:o.googleApi.servicePrivateKey,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.googleApi.servicePrivateKey=e}),placeholder:"key"},null,8,["modelValue"]),ve,(0,l.Wm)(a,{class:"google_input",modelValue:o.googleApi.sheetId,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.googleApi.sheetId=e}),placeholder:"sheet id"},null,8,["modelValue"]),fe,(0,l.Wm)(a,{class:"google_input",modelValue:o.googleApi.folderId,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.googleApi.folderId=e}),placeholder:"folder id"},null,8,["modelValue"]),(0,l._)("div",me,[(0,l.Wm)(u,{type:"submit",disabled:o.isDisabled},{default:(0,l.w5)((function(){return[_e]})),_:1},8,["disabled"]),o.googleApi.isLoading?((0,l.wg)(),(0,l.j4)(c,{key:0})):(0,l.kq)("",!0),(0,l._)("div",ge,(0,n.zw)(o.googleApi.message),1)])],40,ue)}var be=(0,l.aZ)({__name:"TheToolsGoogle",setup:function(e,t){var r=t.expose;r();var o=(0,T.qj)({serviceUser:"",servicePrivateKey:"",sheetId:"",folderId:"",message:"",isLoading:!1}),i=(0,l.Fl)((function(){return!o.serviceUser&&!o.servicePrivateKey&&!o.sheetId&&!o.folderId}));function s(){o.isLoading=!0,P.Z.setGoogleServiceAccountSettings(o.serviceUser,o.servicePrivateKey,o.sheetId,o.folderId).then((function(e){o.message=e.data.message,o.serviceUser="",o.servicePrivateKey="",o.sheetId="",o.folderId=""})).catch((function(e){var t,r;o.message=null===(r=null===(t=null===e||void 0===e?void 0:e.response)||void 0===t?void 0:t.data)||void 0===r?void 0:r.message})).finally((function(){o.isLoading=!1,setTimeout((function(){return o.message=""}),3e3)}))}var n={googleApi:o,isDisabled:i,setGoogleApi:s,ToolsService:P.Z,reactive:T.qj,computed:l.Fl};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}});const he=(0,x.Z)(be,[["render",pe],["__scopeId","data-v-367e6e3c"]]);var we=he,ye=(0,l.aZ)({__name:"TheTools",setup:function(e,t){var r=t.expose;r();var o=(0,T.iH)([]),i=[{name:"По району",value:"district"},{name:"По году",value:"birth"}],s=(0,T.qj)({district:"",birth:{from:"",to:""}});function n(e){o.value=e,o.value.includes("district")||(s.district=""),o.value.includes("birth")||(s.birth.from="",s.birth.to="")}var a=(0,T.qj)({integrate:!1,sheets:!1,adminRights:!1});function u(e){a[e]=!a[e]}var c=(0,T.qj)({serviceUser:"",servicePrivateKey:"",sheetId:"",folderId:"",message:"",isLoading:!1}),d=(0,T.iH)(""),v=(0,T.iH)(!1),f=(0,T.iH)(""),m=(0,l.Fl)((function(){return o.value.includes("district")&&o.value.includes("birth")?v.value||!s.district||!s.birth.to||!s.birth.from:v.value||!s.district&&(!s.birth.to||!s.birth.from)}));function _(){d.value="",v.value=!v.value;var e={district:s.district,birth:{to:s.birth.to||9999,from:s.birth.from||0}};I.Z.saveFormsToSheet(e).then((function(e){f.value=e.data.message,d.value=e.data.link})).catch((function(e){var t,r;return f.value=null===(r=null===(t=null===e||void 0===e?void 0:e.response)||void 0===t?void 0:t.data)||void 0===r?void 0:r.message})).finally((function(){v.value=!1,setTimeout((function(){return f.value=""}),2e3)}))}var g={filter:o,filtersOptions:i,selectedFilters:s,filtered:n,tools:a,setVisible:u,googleApi:c,link:d,isLoading:v,message:f,isDisabled:m,saveFormsToSheet:_,ref:T.iH,reactive:T.qj,computed:l.Fl,AssistanceService:I.Z,ToolsService:P.Z,Constants:j.Z,CheckboxFilter:R,UserList:se,TheToolsGoogle:we};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}});const ke=(0,x.Z)(ye,[["render",Z],["__scopeId","data-v-abfa3064"]]);var Ve=ke,Se=(0,l.aZ)({__name:"ToolsView",setup:function(e,t){var r=t.expose;r();var l=(0,i.o)(),o={store:l,useStore:i.o,TheError:s["default"],TheTools:Ve};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}});const Ue=(0,x.Z)(Se,[["render",o]]);var Ce=Ue}}]);
//# sourceMappingURL=296.faa5719d.js.map